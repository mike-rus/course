pipeline {
    agent any

    parameters {
        string(name: 'endpoint', description: '')
    }

    stages {
        stage('Clone repository') {
            steps {
                // Команда checkout scm должна быть здесь внутри блока steps
                checkout scm
            }
        }

        stage('Display and Modify Makefile') {
            steps {
                script {
                    if (params.endpoint) {
                        // Выводим текущее содержимое Makefile
                        echo "Current Makefile contents:"
                        sh 'cat Makefile'
                        
                        // Проверяем, что параметр 'endpoint' был передан
                        if (params.endpoint) {
                            // Добавляем значение параметра 'endpoint' в Makefile
                            sh "echo 'ENDPOINT=${params.endpoint}' >> Makefile"
                        } else {
                            echo "Parameter 'endpoint' not provided. Please provide the value for 'endpoint'."
                        }
                        
                        // Выводим обновленное содержимое Makefile
                        echo "Updated Makefile contents:"
                        sh 'cat Makefile'
                    } else {
                        echo "Parameter 'file' not provided. Please provide the path to the 'Makefile'."
                    }
                }
            }
        }
    }
}
